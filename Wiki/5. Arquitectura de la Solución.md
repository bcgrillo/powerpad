La arquitectura de PowerPad está diseñada para ofrecer una experiencia de usuario moderna, flexible y extensible, permitiendo la integración avanzada de servicios de inteligencia artificial y la gestión eficiente de documentos y chats. La solución se apoya en una separación clara de responsabilidades, siguiendo los principios SOLID y aprovechando patrones arquitectónicos ampliamente reconocidos en el desarrollo de aplicaciones de escritorio modernas. A continuación se describen los componentes principales que conforman la solución, junto con los patrones de diseño empleados y la organización general de la interfaz y el núcleo de la aplicación.

## 5.1. Descripción de los componentes principales

### 5.1.1. Patrones de diseño utilizados
Para el desarrollo de PowerPad se ha apostado por una arquitectura basada en el patrón MVVM (Model-View-ViewModel), que resulta especialmente adecuado para aplicaciones con interfaces ricas y dinámicas como las que se desarrollan con el marco de trabajo de WinUI. MVVM permite separar de forma clara la lógica de presentación (ViewModel) de la interfaz de usuario (View), facilitando el mantenimiento, la escalabilidad y la prueba de la aplicación. Habitualmente los modelos (Model) encapsulan los datos y la lógica de negocio, aunque en ocasiones se separa la lógica de negocio en servicios específicos, como en nuestro caso. Los ViewModels actúan como intermediarios, exponiendo propiedades y comandos que pueden ser enlazados directamente desde la interfaz.

Además de MVVM, se han incorporado otros patrones y prácticas recomendadas, como la inyección de dependencias, que permite desacoplar la creación y gestión de servicios y facilita la extensión y el testeo de la solución. Para la comunicación entre componentes desacoplados, se utiliza el patrón de mensajería, implementado a través de CommunityToolkit.Mvvm.Messaging, lo que permite que distintos elementos de la aplicación se notifiquen cambios o eventos sin depender directamente unos de otros.

El uso de comandos (RelayCommand) es otra pieza clave, permitiendo que las acciones de la interfaz (como pulsar un botón o seleccionar un elemento) se gestionen de manera desacoplada y testable. Por otro lado, la gestión de recursos y la liberación de memoria se aborda mediante el patrón Disposable, especialmente relevante en una aplicación que maneja múltiples páginas, editores y servicios externos.

Finalmente, se hace un uso intensivo de colecciones observables y propiedades notificables, lo que permite que la interfaz se actualice automáticamente ante cualquier cambio en los datos subyacentes, mejorando la reactividad y la experiencia de usuario.

### 5.1.2. Interfaz
La interfaz de PowerPad está construida sobre WinUI 3, lo que permite aprovechar las capacidades más modernas de diseño y experiencia de usuario en el ecosistema Windows. La aplicación se estructura en torno a una ventana principal (`MainWindow`) que actúa como punto de entrada y contenedor de la navegación lateral, la barra de título personalizada y el área de trabajo principal. Esta ventana principal es responsable de gestionar la navegación entre las distintas páginas y se apoya en un sistema de menús lateral que permite acceder rápidamente a las funcionalidades clave: espacio de trabajo, gestión de modelos, agentes y configuración.

Uno de los aspectos más destacables de la interfaz es la modularidad y reutilización de controles personalizados. Por ejemplo, el control de selección de agentes (`AgentSelector`) y el selector de modelos (`ModelSelector`) permiten al usuario elegir de manera intuitiva entre los agentes y modelos de IA disponibles, mostrando información relevante y facilitando la interacción. El control de chat (`ChatControl`) es otro ejemplo relevante, ya que integra la lógica de conversación con IA, el *streaming* de mensajes y la gestión de parámetros de generación, todo ello presentando una experiencia fluida y visualmente atractiva.

La gestión de documentos y carpetas se realiza a través de un control específico (`WorkspaceControl`), que permite visualizar y manipular la jerarquía de carpetas y documentos mediante operaciones de arrastrar y soltar, renombrado y orden personalizado. Además, la aplicación incluye ventanas emergentes (`PopupWindow`) y diálogos personalizados para tareas como la edición rápida de documentos, la confirmación de acciones o la entrada de texto, mejorando la usabilidad y la productividad.

El diseño visual se apoya en diccionarios de recursos XAML para garantizar la coherencia de estilos, soportando temas claro y oscuro, así como efectos visuales modernos como el fondo acrílico, que contribuyen a una experiencia de usuario actual y agradable. La integración de WebView2, el componente navegador de Microsoft, permite mostrar información detallada de modelos AI directamente de su página web de origen, enriqueciendo la experiencia sin necesidad de salir de la aplicación.

En cuanto a la interacción, se han implementado atajos de teclado globales (*hotkeys*) mediante PInvoke, permitiendo acciones rápidas como copiar contenido o mostrar ventanas emergentes desde cualquier parte del sistema. Todo esto se orquesta a través de ViewModels específicos para cada área funcional (agentes, modelos, chat, documentos, configuración), que exponen las propiedades y comandos necesarios para que la interfaz reaccione de manera dinámica a las acciones del usuario y a los cambios en los datos.

Un ejemplo ilustrativo de esta arquitectura es el flujo de edición de una nota: al seleccionar un documento de tipo nota en el espacio de trabajo, se abre un editor de texto que se comunica con su ViewModel correspondiente. Este ViewModel gestiona el estado del documento, la interacción con los servicios de guardado y autoguardado, y expone comandos para acciones como deshacer o rehacer. Si el usuario decide interactuar con un agente IA desde la nota, el control `NoteAgentControl` permite enviar el contenido al agente seleccionado y recibir sugerencias o ediciones generadas por IA, todo ello gestionado de forma transparente y reactiva.

### 5.1.3. Núcleo
El núcleo de PowerPad, agrupado principalmente en el proyecto `PowerPad.Core`, es el encargado de encapsular la lógica de negocio, la gestión de servicios externos y la definición de los modelos de datos fundamentales. Este núcleo está diseñado para ser completamente independiente de la interfaz, lo que facilita su reutilización, testeo y posible extensión a otras plataformas en el futuro.

Uno de los pilares del núcleo son los servicios de inteligencia artificial, que abstraen la interacción con proveedores externos como Ollama, OpenAI, Azure AI, HuggingFace y GitHub. Cada servicio implementa contratos comunes (por ejemplo, `IAIService`), lo que permite a la aplicación tratar de forma unificada la gestión de modelos, el envío de *prompts* y la recepción de respuestas, independientemente del proveedor subyacente. Esta capa de abstracción es clave para la extensibilidad de la solución, permitiendo añadir nuevos proveedores o modificar los existentes sin impactar en la interfaz ni en el resto de la lógica de negocio.

Junto a los servicios de IA, el núcleo incluye la gestión de documentos y espacio de trabajo. Los documentos y carpetas se representan mediante modelos que encapsulan tanto los datos (contenido, información del archivo, estado de guardado) como la lógica asociada (operaciones de guardado, renombrado, ordenación). La gestión de la estructura jerárquica de carpetas y documentos, así como el soporte para operaciones como arrastrar y soltar, se implementa en servicios especializados que garantizan la integridad y la persistencia de la información.

Otro aspecto relevante del núcleo es la gestión de agentes y modelos AI. Los agentes se definen mediante modelos que incluyen información sobre el prompt inicial, los parámetros de generación y la asociación con modelos específicos. Esto permite a los usuarios crear y personalizar agentes adaptados a distintos contextos de uso, desde asistentes generales hasta agentes especializados en tareas concretas. La gestión de modelos AI, por su parte, incluye la búsqueda, descarga, instalación y eliminación de modelos, así como la configuración de parámetros predeterminados y la comprobación del estado de los servicios.

La configuración y la persistencia de datos se gestionan mediante servicios que abstraen la lectura y escritura de archivos JSON, garantizando la concurrencia segura y la integridad de la información. Estos servicios permiten almacenar y recuperar la configuración de la aplicación, los modelos y agentes definidos por el usuario, y el estado del espacio de trabajo, facilitando la personalización y la continuidad entre sesiones.

Para facilitar la interacción con APIs externas y la manipulación de datos, el núcleo incluye una serie de *helpers* para la integración con las APIs de Hugging Face y GitHub Marketplace para la descarga de modelos, o el scrapping de la web de Ollama.com para consulta de los modelos publicados en su librería (NOTA: a fecha de este proyecto Ollama no ofrece un API para consulta de su librería de modelos). Estas utilidades contribuyen a modularizar la lógica y a evitar la duplicidad de código, mejorando la mantenibilidad y la claridad de la solución.

En resumen, el núcleo de PowerPad actúa como el motor de la aplicación, gestionando la lógica de negocio, la interacción con servicios externos y la persistencia de datos, mientras que la interfaz se encarga de presentar esta información de manera intuitiva y atractiva al usuario. Esta separación de responsabilidades, junto con el uso de patrones de diseño sólidos y tecnologías modernas, permite que PowerPad sea una solución robusta, escalable y preparada para evolucionar en el futuro.