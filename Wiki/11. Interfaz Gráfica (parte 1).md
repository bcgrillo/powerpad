La sección dedicada a la Interfaz Gráfica de PowerPad tiene como objetivo ofrecer una visión detallada de todos los elementos visuales que conforman la experiencia de usuario de la aplicación. Aquí describiremos y detallaremos de manera estructurada las distintas ventanas, páginas, componentes y controles personalizados que se han desarrollado para facilitar la interacción con el usuario. Además, se destacan los aspectos clave de diseño y usabilidad que guían la disposición y funcionalidad de cada elemento, así como las decisiones tomadas para lograr una interfaz moderna, intuitiva y coherente con los objetivos del proyecto. Esta sección sirve como guía para comprender cómo se organiza visualmente PowerPad y cómo cada parte contribuye al flujo de trabajo general y a la integración de las capacidades de inteligencia artificial.

## 11.1. Ventanas

#### MainWindow
**Descripción general:**  
La clase `MainWindow` representa la ventana principal de la aplicación PowerPad. Su propósito es gestionar la navegación entre diferentes páginas (Workspace, Modelos, Agentes y Configuración), controlar la apariencia visual (incluyendo el fondo acrílico y la barra de título), y manejar la integración con la bandeja del sistema (minimizar/restaurar). Además, responde a eventos de configuración y estado de servicios de IA, mostrando avisos visuales de error y permitiendo la interacción con el menú lateral de navegación.

**Estructura visual simplificada:**  
```xml
<wuiex:WindowEx x:Class="PowerPad.WinUI.MainWindow">
    <Page x:Name="MainPage">
        <Grid>
            <Border x:Name="AppIcon">
                <Image/>
            </Border>
            <NavigationView x:Name="NavView">
                <NavigationView.MenuItems>
                    <NavigationViewItem Content="Workspace" Tag="WorkspacePage"/>
                    <NavigationViewItem Content="Modelos" Tag="ModelsPage"/>
                    <NavigationViewItem Content="Agentes" Tag="AgentsPage"/>
                </NavigationView.MenuItems>
                <Frame x:Name="NavFrame"/>
            </NavigationView>
            <FontIcon x:Name="ErrorBadge"/>
            <Border x:Name="Splitter"/>
            <Grid x:Name="TitleContent">
                <Button x:Name="ToggleMenuBtn">
                    <FontIcon x:Name="ToggleMenuIcon"/>
                </Button>
                <Border x:Name="TitleBar">
                    <TextBlock Text="PowerPad"/>
                </Border>
                <Button x:Name="MinimizeToTray">
                    <FontIcon/>
                </Button>
                <hni:TaskbarIcon x:Name="TaskbarIcon">
                    <hni:TaskbarIcon.ContextFlyout>
					...
                    </hni:TaskbarIcon.ContextFlyout>
                </hni:TaskbarIcon>
            </Grid>
        </Grid>
    </Page>
</wuiex:WindowEx>
```

**Código simplificado:**  
```csharp
public partial class MainWindow : WindowEx
{
    private readonly SettingsViewModel _settings;
    private readonly Dictionary<string, Type> _navigation = new()
    {
        { nameof(WorkspacePage), typeof(WorkspacePage) },
        { nameof(ModelsPage), typeof(ModelsPage) },
        { nameof(SettingsPage), typeof(SettingsPage) },
        { nameof(AgentsPage), typeof(AgentsPage) },
    };
    private string? _activePageName;
    private IToggleMenuPage? _activeToggleMenuPage;

    public MainWindow() { ... }

    public void SetBackdrop(bool value) { ... }
    public void ShowNotes() { ... }
    private void NavView_Loaded(object _, RoutedEventArgs __) { ... }
    private void UpdateNavMenuItems() { ... }
    private void SetTitleBar() { ... }
    private void NavView_SelectionChanged(object _, NavigationViewSelectionChangedEventArgs eventArgs) { ... }
    private void NavigateToPage(string? page) { ... }
    private void SetToggleVisualElements() { ... }
    private void ToggleMenuBtn_Click( ... ) { ... }
    private void MinimizeToTray_Click( ... ) { ... }
    private void Show_Click( ... ) { ... }
    private void Exit_Click( ... ) { ... }
}
```

**Elementos visuales:**  
- `AppIcon`: Elemento visual que contiene el icono de la aplicación.
- `NavView`: NavigationView principal para la navegación entre páginas.
- `NavFrame`: Frame donde se cargan las páginas seleccionadas.
- `ErrorBadge`: FontIcon que muestra un aviso visual de error junto al icono de configuración.
- `Splitter`: Border que actúa como separador visual entre el menú y el contenido.
- `TitleContent`: Grid que contiene elementos de la barra de título.
- `ToggleMenuBtn`: Botón para mostrar/ocultar el menú de navegación.
- `TitleBar`: Border que contiene el título de la aplicación.
- `MinimizeToTray`: Botón para minimizar la ventana a la bandeja del sistema.
- `TaskbarIcon`: Icono en la bandeja del sistema, con menú contextual para restaurar o salir.

**ViewModels:**  
- `_settings`: Instancia de `SettingsViewModel` que gestiona la configuración general, modelos y servicios de IA.

**Otras propiedades:**  
- `_navigation`: Diccionario que asocia nombres de páginas con sus tipos para la navegación.
- `_activePageName`: Nombre de la página actualmente activa.
- `_activeToggleMenuPage`: Referencia a la página activa que implementa `IToggleMenuPage`.

**Métodos públicos:**
- `void SetBackdrop(bool value)`: Establece el efecto de fondo acrílico para la ventana principal según la configuración y el tema de la aplicación.
- `void ShowNotes()`: Muestra la ventana principal y selecciona la página de notas en la navegación. Se utiliza para visualizar una nueva nota creada desde la ventana emergente.

**Otros métodos relevantes:**
- `void NavView_Loaded()`: Maneja el evento de carga del control NavigationView. Inicializa la selección de menú, suscribe eventos de cambio de estado de servicios de IA y realiza pruebas de conexión. Si es necesario, muestra el diálogo de instalación de Ollama y actualiza los elementos del menú de navegación.
- `void UpdateNavMenuItems()`: Actualiza la habilitación de los elementos del menú de navegación y la visibilidad del indicador de error en función del estado de los servicios de IA configurados.
- `void SetTitleBar()`: Configura la barra de título de la ventana principal.
- `void NavView_SelectionChanged(NavigationViewSelectionChangedEventArgs eventArgs)`: Maneja el cambio de selección en el menú de navegación, navegando a la página correspondiente o a la configuración si se selecciona el ítem de ajustes.
- `void NavigateToPage(string? page)`: Navega a la página especificada por nombre, actualizando el contenido del frame de navegación y los elementos visuales relacionados con el menú lateral.
- `void SetToggleVisualElements()`: Ajusta los elementos visuales de la interfaz relacionados con la visibilidad y el ancho del menú de navegación lateral, incluyendo el splitter y el icono del botón de mostrar u ocultar menú.
- `void ToggleMenuBtn_Click(RoutedEventArgs eventArgs)`: Maneja el evento de clic en el botón para mostrar u ocultar el menú lateral.
- `void MinimizeToTray_Click(RoutedEventArgs eventArgs)`: Minimiza la ventana principal a la bandeja del sistema, mostrando el icono correspondiente.
- `void Show_Click(RoutedEventArgs eventArgs)`: Restaura la ventana principal desde la bandeja del sistema y oculta el icono de la bandeja.
- `void Exit_Click(RoutedEventArgs eventArgs)`: Cierra la aplicación.

**Notas adicionales:**
- El evento `Closed` de la ventana principal almacena la configuración y realiza el guardado automático de editores antes de liberar recursos relacionados con el fondo acrílico.
- El menú de navegación y los elementos visuales se adaptan dinámicamente según la disponibilidad de servicios de IA y la configuración del usuario.
- La clase `MainWindow` hereda de `WindowEx`, una extensión personalizada de la ventana estándar que proporciona soporte adicional para características avanzadas de interfaz de usuario, como la integración con el fondo acrílico, la personalización de la barra de título y otras mejoras visuales específicas de la plataforma WinUI.

#### PopupWindow
**Descripción general:**  
`PopupWindow` representa una ventana emergente personalizada dentro de la aplicación PowerPad. Su propósito es mostrar un editor de notas asistido por IA en una ventana flotante, con integración de configuraciones visuales (tema, fondo acrílico) y comportamiento personalizado (centrado, siempre visible y no redimensionable).

**Estructura visual simplificada:**  
```xml
<wuiex:WindowEx x:Class="PowerPad.WinUI.PopupWindow">
    <local:PopupEditorPage x:Name="PopupEditorPage" />
</wuiex:WindowEx>
```

**Código simplificado:**  
```csharp
public sealed partial class PopupWindow : WindowEx
{
    private readonly SettingsViewModel _settings;

    public PopupWindow() { ... }
    public void ShowPopup() { ... }
    public void SetContent(string newContent) { ... }

    private void PopupEditorPage_CloseRequested( ... ) { ... }
    private void PopupWindow_Closed( ... ) { ... }
}
```

**Elementos visuales:**  
- `PopupEditorPage`: Página de edición emergente que contiene la interfaz de edición y gestiona el evento de solicitud de cierre.

**ViewModels:**  
- `_settings`: Instancia de `SettingsViewModel` que gestiona la configuración general, modelos y servicios de IA.

**Métodos públicos:**
- `void ShowPopup()`: Muestra la ventana emergente, la centra en la pantalla, la establece como siempre visible encima de otras ventanas y enfoca el editor.
- `void SetContent(string newContent)`: Establece el contenido del editor emergente con el texto proporcionado.

**Otros métodos relevantes:**
- `void PopupEditorPage_CloseRequested()`: Maneja la solicitud de cierre del editor emergente, cerrando la ventana. Es relevante ya que el cierre se solicita desde un control de la página dentro de la ventana, al tratarse de una ventana que no posee los botones habituales de Windows para minimizar, maximizar y cierre.
- `void PopupWindow_Closed(WindowEventArgs eventArgs)`: Maneja el evento de cierre de la ventana emergente, marcando el evento como gestionado, desactiva el modo "siempre visible" y oculta la ventana.

**Notas adicionales:**
- La ventana utiliza un fondo acrílico y tema configurable, al igual que la ventana principal.
- La clase `MainWindow` hereda de `WindowEx`, una extensión personalizada de la ventana estándar que proporciona soporte adicional para características avanzadas de interfaz de usuario, como la integración con el fondo acrílico, la personalización de la barra de título y otras mejoras visuales específicas de la plataforma WinUI.

## 11.2 Páginas

### 11.2.1. Páginas principales

#### WorkspacePage
**Descripción general:**  
`WorkspacePage` representa la página principal del área de trabajo en la aplicación. Su propósito es proporcionar una interfaz para la navegación y gestión de archivos, permitiendo al usuario interactuar con el sistema de archivos y editar documentos con ayuda de IA. Utiliza controles personalizados para la navegación y edición.

**Estructura visual simplificada:**  
```xml
<local:DisposablePage x:Class="PowerPad.WinUI.Pages.WorkspacePage">
    <Grid>
        <components:WorkspaceControl 
	        x:Name="WorkspaceControl"
			ItemInvoked="WorkspaceControl_ItemInvoked" />
        <Border Grid.Row="1" Grid.Column="1">
            <components:EditorManager x:Name="EditorManager" />
        </Border>
    </Grid>
</local:DisposablePage>
```

**Código simplificado:**  
```csharp
public partial class WorkspacePage : DisposablePage, IToggleMenuPage
{
    public double NavigationWidth => ... WorkspaceControl.ActualWidth;
    
    public WorkspacePage() { ... }
    public void ToggleNavigationVisibility() { ... }
    
    private void WorkspaceControl_ItemInvoked( ... ) { ... }
    protected override void Dispose(bool disposing) { ... }
}
```

**Elementos visuales:**  
- `WorkspaceControl`: Control personalizado para la navegación y gestión de archivos en el área de trabajo. Permite seleccionar y abrir archivos.
- `EditorManager`: Control personalizado encargado de la gestión de los editores y de su ciclo de vida.

**Otras propiedades:**  
- `NavigationWidth`: Devuelve el ancho del panel de navegación dependiendo de su visibilidad.

**Métodos públicos:**
- `void ToggleNavigationVisibility()`: Alterna la visibilidad del panel de navegación, mostrando u ocultando el control de espacio de trabajo según su estado actual.

**Otros métodos relevantes:**
- `double NavigationWidth`: Propiedad que obtiene el ancho del panel de navegación en función de su visibilidad. Si el panel está visible, devuelve su ancho real; si está oculto, devuelve 0.
- `void WorkspaceControl_ItemInvoked(WorkspaceControlItemInvokedEventArgs eventArgs)`: Maneja el evento cuando se invoca un elemento en el control de espacio de trabajo, abriendo el archivo seleccionado en el administrador de editores.

**Notas adicionales:**
- El método `WorkspaceControl_ItemInvoked` es privado y se asocia al evento `ItemInvoked` del control visual de espacio de trabajo.
- La clase hereda de `DisposablePage` y cumple con la interfaz `IToggleMenuPage`.

#### ModelsPage
**Descripción general:**  
La clase `ModelsPage` representa una página dentro de la aplicación PowerPad dedicada a la gestión y navegación entre diferentes proveedores de modelos de IA y sus respectivas opciones (ver modelos disponibles o añadir nuevos modelos). Utiliza un control `NavigationView` para mostrar los distintos proveedores y opciones, y un `Frame` para cargar dinámicamente las páginas correspondientes según la selección del usuario. Gestiona la visibilidad y navegación del panel lateral, así como la interacción con las páginas hijas especializadas en cada proveedor de modelos.

**Estructura visual simplificada:**  
```xml
<local:DisposablePage
    x:Class="PowerPad.WinUI.Pages.ModelsPage">
    <Grid>
        <NavigationView x:Name="NavView">
            <NavigationView.PaneHeader>
                <Border>
                    <TextBlock Text="Modelos"/>
                </Border>
            </NavigationView.PaneHeader>
            <NavigationView.MenuItems>
                <NavigationViewItem x:Name="OllamaMenuItem" Content="Ollama" Tag="{x:Bind ...}">
                    <NavigationViewItem.MenuItems>
                        <NavigationViewItem Content="Modelos disponibles" Tag="{x:Bind ...}"/>
                        <NavigationViewItem Content="Añadir modelo" Tag="{x:Bind ...}"/>
                    </NavigationViewItem.MenuItems>
                </NavigationViewItem>
                <NavigationViewItem x:Name="HuggingFaceMenuItem" ...>
                    ...
                </NavigationViewItem>
                <NavigationViewItem x:Name="GitHubMenuItem" ...>
                    ...
                </NavigationViewItem>
                <NavigationViewItem x:Name="OpenAIMenuItem" ...>
                    ...
                </NavigationViewItem>
            </NavigationView.MenuItems>
            <Frame x:Name="NavFrame"/>
        </NavigationView>
    </Grid>
</local:DisposablePage>
```

**Código simplificado:**  
```csharp
public partial class ModelsPage : DisposablePage, IToggleMenuPage
{
    private readonly SettingsViewModel _settings;
    private IModelProviderPage? _currentPage;
    private bool _runSearch;
    
    public double NavigationWidth => ... NavView.OpenPaneLength;
    
    public ModelsPage() { ... }
    public void ToggleNavigationVisibility() { ... }
    
    private void NavView_SelectionChanged( ... ) { ... }
    private void NavigateToPage(ModelsMenuOption menuOption) { ... }
    private void NavView_Loaded( ... ) { ... }
    private void AddButtonClick( ... ) { ... }
    private void NavView_PointerPressed( ... ) { ... }
    protected override void Dispose(bool disposing) { ... }
}
```

**Elementos visuales:**  
- `NavView`: Control principal de navegación lateral (`NavigationView`) que contiene los menús de los proveedores de modelos y sus opciones.
- `NavFrame`: Contenedor (`Frame`) donde se navegan y muestran las páginas correspondientes a la opción seleccionada.
- `OllamaMenuItem`: Elemento de menú para el proveedor Ollama.
- `HuggingFaceMenuItem`: Elemento de menú para el proveedor Hugging Face.
- `GitHubMenuItem`: Elemento de menú para el proveedor GitHub.
- `OpenAIMenuItem`: Elemento de menú para el proveedor OpenAI.

**ViewModels:**  
- `_settings`: Instancia de `SettingsViewModel` que gestiona la configuración general, modelos y servicios de IA.

**Otras propiedades:**  
- `_currentPage`: Referencia a la página actualmente cargada en el `NavFrame` (`IModelProviderPage`), utilizada para gestionar el ciclo de vida y eventos de la página activa.
- `_runSearch`: Indicador booleano para determinar si debe ejecutarse una búsqueda automática al navegar a la página de añadir modelos.
- `NavigationWidth`: Propiedad que obtiene el ancho del panel de navegación en función de su visibilidad. Si el panel está visible, devuelve su ancho real; si está oculto, devuelve 0.

**Métodos públicos:**
- `void ToggleNavigationVisibility()`: Alterna la visibilidad del panel de navegación, mostrando u ocultando el control de espacio de trabajo según su estado actual.

**Otros métodos relevantes:**
- `void NavView_SelectionChanged(NavigationViewSelectionChangedEventArgs eventArgs)`: Gestiona el evento de cambio de selección en el NavigationView, navegando a la página correspondiente o expandiendo el elemento seleccionado.
- `void NavigateToPage(ModelsMenuOption menuOption)`: Navega a la página adecuada según la opción de menú seleccionada, gestionando la suscripción a eventos y la búsqueda automática si corresponde.
- `void NavView_Loaded()`: Gestiona el evento Loaded del NavigationView, seleccionando y expandiendo el primer elemento visible del menú.
- `void AddButtonClick()`: Gestiona el evento de clic en el botón "Añadir", navegando a la página de adición de modelos correspondiente y activando la búsqueda automática.
- `void NavView_PointerPressed()`: Gestiona el evento PointerPressed para cerrar el visor de información del modelo activo.
- `protected override void Dispose(bool disposing)`: Libera los recursos utilizados por la página, anulando suscripciones y eliminando la instancia de la página actual si es necesario.

**Notas adicionales:**
- El método Dispose asegura la correcta liberación de recursos y la desvinculación de eventos para evitar fugas de memoria.
- El comportamiento de navegación y visibilidad de los elementos del menú depende de la configuración de la aplicación y del estado de los proveedores de modelos habilitados.

#### AgentsPage
**Descripción general:**  
La clase `AgentsPage` representa una página dentro de la aplicación dedicada a la gestión de agentes de IA. Permite visualizar, crear, editar, renombrar y eliminar agentes, mostrando una lista jerárquica de agentes en un menú lateral y un área principal para la edición o visualización de información relevante. Integra el ViewModel de colección de agentes y controles personalizados para la interacción.

**Estructura visual simplificada:**  
```xml
<local:DisposablePage x:Class="PowerPad.WinUI.Pages.AgentsPage">
    <Grid>
        <Grid x:Name="AgentsMenu" Grid.RowSpan="2">
            <TextBlock Text="Agentes"/>
            <ScrollViewer Grid.Row="1">
                <TreeView Name="TreeView" ItemsSource="{x:Bind _agentsCollection.Agents}">
                    <TreeView.ItemTemplate>
                        <DataTemplate x:DataType="vmagents:AgentViewModel">
                            <TreeViewItem>
								<controls:AgentIconControl AgentIcon="{x:Bind Icon}" />
								<controls:Label Text="{x:Bind Name}"/>
                            </TreeViewItem>
                        </DataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </ScrollViewer>
            <Grid Grid.Row="2">
                <Button x:Name="NewAgentButton">
					<TextBlock Text="Añadir agente" />
                </Button>
            </Grid>
        </Grid>
        <Grid Grid.Row="1" Grid.Column="1">
            <StackPanel x:Name="AgentLanding">
                <Image>
					<BitmapImage UriSource=".../LandingAgents.png" />
                </Image>
                <TextBlock Text="Seleccione un agente para modificarlo o cree uno nuevo."/>
                <Button>
					<TextBlock Text="Crear un nuevo agente" />
                </Button>
            </StackPanel>
            <Grid x:Name="AgentEditorContent" />
        </Grid>
    </Grid>
</local:DisposablePage>
```

**Código simplificado:**  
```csharp
public partial class AgentsPage : DisposablePage, IToggleMenuPage
{
    private readonly AgentsCollectionViewModel _agentsCollection;
    private bool _undoSelectionChange = false;
    private AgentViewModel? _selectedAgent;
    private AgentEditorControl? _editorControl;
    
    public double NavigationWidth => ... TreeView.ActualWidth;
    
    public AgentsPage() { ... }
    public void ToggleNavigationVisibility() { ... }
    
    private async void TreeView_SelectionChanged( ... ) { ... }
    private void UpdateLandingVisibility(bool showLanding) { ... }
    private void NewAgentButton_Click( ... ) { ... }
    private async void RenameFlyoutItem_Click( ... ) { ... }
    private async void DeleteFlyoutItem_Click( ... ) { ... }
    private void MoreButton_Click( ... ) { ... }
    private void TreeViewItem_DropCompleted( ... ) { ... }
    protected override void Dispose(bool disposing) { ... }
}
```

**Elementos visuales:**  
- `AgentsMenu`: Grid que contiene el menú lateral de agentes.
- `TreeView`: Árbol de agentes, permite seleccionar y organizar agentes.
- `NewAgentButton`: Botón para crear un nuevo agente, ubicado en el menú lateral.
- `AgentLanding`: StackPanel central que muestra una imagen y mensaje cuando no hay agente seleccionado.
- `AgentEditorContent`: Grid donde se carga dinámicamente el editor de agentes.
- `Image`: Imagen ilustrativa en la pantalla de bienvenida.
- `TextBlock`: Varios, para títulos, subtítulos y etiquetas de agentes.
- `Button`: Varios, para acciones como crear, mostrar más opciones, renombrar y eliminar.
- `MenuFlyout`: Menú contextual para acciones sobre agentes.
- `controls:AgentIconControl`: Control personalizado para mostrar el icono del agente.
- `controls:Label`: Control personalizado para mostrar el nombre del agente.
- `FontIcon`: Iconos visuales en botones y menús.
- `ScrollViewer`: Permite el desplazamiento vertical y horizontal del árbol de agentes.

**ViewModels:**  
- `_agentsCollection`: Instancia de `AgentsCollectionViewModel`, contiene la colección de agentes y lógica asociada.
- `_selectedAgent`: Instancia de `AgentViewModel`, representa el agente actualmente seleccionado.

**Otras propiedades:**  
- `_undoSelectionChange`: Indica si se debe deshacer un cambio de selección en el TreeView.
- `_editorControl`: Control de edición del agente actualmente seleccionado.
- `NavigationWidth`: Propiedad que obtiene el ancho del panel de navegación en función de su visibilidad. Si el panel está visible, devuelve su ancho real; si está oculto, devuelve 0.

**Métodos públicos:**
- `void ToggleNavigationVisibility()`: Alterna la visibilidad del panel de navegación, mostrando u ocultando el control de espacio de trabajo según su estado actual.

**Otros métodos relevantes:**
- `async void TreeView_SelectionChanged(TreeViewSelectionChangedEventArgs eventArgs)`: Gestiona el evento de cambio de selección en el `TreeView`, permitiendo confirmar el cierre del editor, actualizar la selección y mostrar el editor o la página de bienvenida según corresponda.
- `void UpdateLandingVisibility(bool showLanding)`: Actualiza la visibilidad entre la página de bienvenida y el contenido del editor de agente.
- `void NewAgentButton_Click()`: Gestiona el evento de creación de un nuevo agente, añadiéndolo a la colección y seleccionándolo automáticamente.
- `async void RenameFlyoutItem_Click(object sender)`: Gestiona el evento de renombrar un agente, mostrando un cuadro de diálogo para introducir el nuevo nombre.
- `async void DeleteFlyoutItem_Click(object sender)`: Gestiona el evento de eliminación de un agente, mostrando una confirmación y eliminando el agente seleccionado si procede.
- `void MoreButton_Click(object sender)`: Gestiona el evento de mostrar el menú contextual de un agente.
- `void TreeViewItem_DropCompleted(UIElement sender)`: Gestiona el evento de finalización de arrastre de un elemento en el `TreeView`, lo que permite ordenar los agentes en la lista.
- `protected override void Dispose(bool disposing)`: Libera recursos utilizados. En esta implementación, no realiza ninguna acción.

**Notas adicionales:**
- El control visual principal es un menú de agentes con un `TreeView` para listar, seleccionar, renombrar y eliminar agentes, así como un área de edición y una página de bienvenida.
- El control de edición de agentes (`AgentEditorControl`) se instancia y elimina dinámicamente según la selección del usuario.

#### SettingsPage
**Descripción general:**  
La clase `SettingsPage` representa la página de configuración de la aplicación PowerPad. Permite a los usuarios gestionar y personalizar los servicios de IA (Ollama, Azure AI, OpenAI), parámetros de modelos, agentes, apariencia (tema) y otras opciones generales. La página enlaza la interfaz visual con el `SettingsViewModel` para reflejar y modificar el estado de la configuración de la aplicación. Incluye controles para habilitar/deshabilitar servicios, editar URLs y claves, seleccionar modelos por defecto, ajustar parámetros de IA, cambiar el tema visual y ver información sobre la aplicación.

**Estructura visual simplificada:**  
Debido a la complejidad de la página, se incluye solamente un extracto de ejemplo con un bloque de configuración.
```xml
<local:DisposablePage x:Class="PowerPad.WinUI.Pages.SettingsPage">
...
	<StackPanel Orientation="Horizontal">
	    <TextBlock Text="Servicios locales" />
	</StackPanel>
	<tkcontrols:SettingsExpander x:Name="OllamaModelsExpander">
	    <tkcontrols:SettingsExpander.Header>
	        <StackPanel Orientation="Horizontal">
	            <TextBlock Text="Ollama" />
	        </StackPanel>
	    </tkcontrols:SettingsExpander.Header>
	    <StackPanel Orientation="Horizontal">
	        <ToggleSwitch IsOn="{x:Bind _settings.General.OllamaEnabled}" />
	    </StackPanel>
	    <tkcontrols:SettingsExpander.ItemsHeader>
			<TextBlock Grid.Column="1" Text="{x:Bind _settings.General.OllamaConfig.ErrorMessage}" />
			<Button Grid.Column="2" x:Name="OllamaRetryButton">
				<TextBlock>Reintentar</TextBlock>
			</Button>
	    </tkcontrols:SettingsExpander.ItemsHeader>
	    <tkcontrols:SettingsExpander.Items>
	        <tkcontrols:SettingsCard>
	            <tkcontrols:SettingsCard.Header>
					<TextBlock Grid.Column="1" Text="{x:Bind _settings.General.OllamaConfig.ServiceStatus}" />
	            </tkcontrols:SettingsCard.Header>
	            <tkcontrols:SwitchPresenter Value="{x:Bind _settings.General.OllamaConfig.ServiceStatus}">
	                <tkcontrols:Case Value="{x:Bind mai:ServiceStatus.Online}">
	                    <Button x:Name="StopOllama">
							<TextBlock>Parar</TextBlock>
	                    </Button>
	                </tkcontrols:Case>
	                <tkcontrols:Case Value="{x:Bind mai:ServiceStatus.Available}">
	                    <Button x:Name="StartOllama">
							<TextBlock>Iniciar</TextBlock>
	                    </Button>
	                </tkcontrols:Case>
	                <tkcontrols:Case Value="{x:Bind mai:ServiceStatus.NotFound}">
	                    <Button x:Name="InstallOllama">
							<TextBlock>Instalar</TextBlock>
	                    </Button>
	                </tkcontrols:Case>
	            </tkcontrols:SwitchPresenter>
	        </tkcontrols:SettingsCard>
	        <Border>
	            <Grid>
	                <controls:EditableTextBlock Grid.Column="1" x:Name="OllamaUrlTextBox" Value="{x:Bind _settings.General.OllamaConfig.BaseUrl}" />
	            </Grid>
	        </Border>
	        <tkcontrols:SettingsCard>
	            <CheckBox IsChecked="{x:Bind _settings.General.OllamaAutostart}">
	                <TextBlock>Iniciar Ollama automáticamente al abrir</TextBlock>
	            </CheckBox>
	        </tkcontrols:SettingsCard>
	    </tkcontrols:SettingsExpander.Items>
	</tkcontrols:SettingsExpander>
...
</local:DisposablePage>
```

**Código simplificado:**  
```csharp
public partial class SettingsPage : DisposablePage
{
    private readonly SettingsViewModel _settings;
    private readonly InputCursor _defaultCursor;
    private readonly ApplicationTheme? _originalTheme;

    public SettingsPage() { ... }

    private async void StartOllama_Click( ... ) { ... }
    private async void InstallOllama_Click( ... ) { ... }
    private async void StopOllama_Click( ... ) { ... }
    private async void TestOllama( ... ) { ... }
    private async void TestAzureAI( ... ) { ... }
    private async void TestOpenAI( ... ) { ... }
    private void SetModelsMenu( ... ) { ... }
    private void SetModelItem_Click( ... ) { ... }
    private void DefaultModelButton_Click( ... ) { ... }
    private void ThemeInfoBarButton_Click( ... ) { ... }
    private void ThemeRadioButton_Checked( ... ) { ... }
    private void OllamaModelsExpander_Toggled( ... ) { ... }
    private void AzureAIModelsExpander_Toggled( ... ) { ... }
    private void OpenAIModelsExpander_Toggled( ... ) { ... }
    private void TestEnabledService( ... ) { ... }
    private void RetryButton_Click( ... ) { ... }
    protected override void Dispose(bool disposing) { ... }
}
```

**Elementos visuales:**  
- `ModelsScrollViewer`: ScrollViewer que contiene todo el contenido desplazable de la página.
- `OllamaModelsExpander`: Expander para la configuración del servicio Ollama.
- `OllamaRetryButton`: Botón para reintentar la conexión con Ollama.
- `StopOllama`: Botón para detener el servicio Ollama.
- `StartOllama`: Botón para iniciar el servicio Ollama.
- `InstallOllama`: Botón para instalar Ollama.
- `OllamaUrlTextBox`: Campo editable para la URL de Ollama.
- `AzureAIModelsExpander`: Expander para la configuración del servicio Azure AI.
- `AzureAIRetryButton`: Botón para reintentar la conexión con Azure AI.
- `AzureAIUrlTextBox`: Campo editable para la URL de Azure AI.
- `AzureAIKeyTextBox`: Campo editable para la clave de Azure AI.
- `OpenAIModelsExpander`: Expander para la configuración del servicio OpenAI.
- `OpenAIRetryButton`: Botón para reintentar la conexión con OpenAI.
- `OpenAIUrlTextBox`: Campo editable para la URL de OpenAI.
- `OpenAIKeyTextBox`: Campo editable para la clave de OpenAI.
- `DefaultModelCard`: Tarjeta para seleccionar el modelo predeterminado.
- `DefaultModelButton`: Botón desplegable para elegir el modelo predeterminado.
- `DefaultModelFlyoutMenu`: Menú desplegable con los modelos disponibles.
- `DefaultParameterCard`: Expander para parámetros por defecto de los modelos.
- `AgentConfigCard`: Expander para configuración de agentes.
- `ThemeInfoBar`: Barra informativa para reinicio por cambio de tema.
- `ThemeInfoBarButton`: Botón para reiniciar la aplicación.
- `LightThemeRadioButton`: RadioButton para seleccionar tema claro.
- `DarkThemeRadioButton`: RadioButton para seleccionar tema oscuro.
- `SystemThemeRadioButton`: RadioButton para seleccionar el tema del sistema.

**ViewModels:**  
- `_settings`: Instancia de `SettingsViewModel` que gestiona la configuración general, modelos y servicios de IA.

**Otras propiedades:**  
- `_defaultCursor`: Cursor por defecto de la página, usado para restaurar el cursor tras operaciones asíncronas.
- `_originalTheme`: Tema original de la aplicación al cargar la página, para detectar cambios y mostrar la barra de reinicio.

**Métodos públicos:**
- `Dispose(bool disposing)`: Libera los recursos utilizados por la clase `SettingsPage`, eliminando los manejadores de eventos asociados a la configuración y modelos.

**Otros métodos relevantes:**
- `StartOllama_Click()`: Inicia el servicio Ollama y prueba la conexión con el mismo. Muestra un cursor de espera durante la operación.
- `InstallOllama_Click()`: Abre un diálogo para instalar Ollama y prueba las conexiones según la elección del usuario. Deshabilita Ollama si el usuario cancela.
- `StopOllama_Click()`: Detiene el servicio Ollama y prueba la conexión. Muestra un cursor de espera durante la operación.
- `TestOllama()`: Prueba la conexión del servicio Ollama si la URL está configurada.
- `TestAzureAI()`: Prueba la conexión del servicio Azure AI si la URL y la clave están configuradas.
- `TestOpenAI()`: Prueba la conexión del servicio OpenAI si la URL y la clave están configuradas.
- `SetModelsMenu()`: Actualiza el menú de selección de modelos predeterminados según los proveedores y modelos disponibles, habilitando o deshabilitando los controles relacionados.
- `SetModelItem_Click()`: Establece el modelo seleccionado como modelo predeterminado al hacer clic en un elemento del menú.
- `DefaultModelButton_Click()`: Marca como seleccionado el modelo predeterminado actual en el menú desplegable de modelos.
- `ThemeInfoBarButton_Click()`: Reinicia la aplicación para aplicar los cambios de tema seleccionados por el usuario.
- `ThemeRadioButton_Checked()`: Actualiza el tema de la aplicación cuando el usuario selecciona una opción de tema y muestra una barra informativa si es necesario reiniciar.
- `OllamaModelsExpander_Toggled()`: Gestiona el evento de alternancia del expander de Ollama, enfocando el campo de URL si se intenta habilitar sin configuración.
- `AzureAIModelsExpander_Toggled()`: Gestiona el evento de alternancia del expander de Azure AI, enfocando los campos de URL y clave si se intenta habilitar sin configuración.
- `OpenAIModelsExpander_Toggled()`: Gestiona el evento de alternancia del expander de OpenAI, enfocando los campos de URL y clave si se intenta habilitar sin configuración.
- `TestEnabledService()`: Prueba el servicio habilitado correspondiente cuando cambia su configuración.
- `RetryButton_Click()`: Gestiona el evento de clic en los botones de reintento para probar la conexión de los servicios Ollama, Azure AI u OpenAI.

**Notas adicionales:**
- Los métodos de prueba de conexión muestran un cursor de espera para mejorar la experiencia de usuario.
- El menú de modelo por defecto se actualiza dinámicamente según la disponibilidad de proveedores y modelos.
- El reinicio de la aplicación es necesario para aplicar cambios de tema, y se gestiona de forma automática desde la interfaz.

### 11.2.2. Páginas de gestión de modelos

#### AIModelsPageBase
**Descripción general:**
Clase base abstracta para las páginas que gestionan los modelos de IA. Proporciona funcionalidad común para el manejo de modelos de inteligencia artificial, incluyendo comandos para establecer el modelo por defecto, eliminar modelos y gestionar eventos relacionados con la interfaz de usuario, que serán utilizados desde las implementaciones específicas.

**Código simplificado:**
```csharp
public abstract class AIModelsPageBase() : DisposablePage, IModelProviderPage
{
    protected SettingsViewModel _settings;
    protected AIModelsViewModelBase _modelsViewModel;
    
    public event EventHandler? AddButtonClick;
    public abstract void CloseModelInfoViewer();
    
    protected void SetDefault_Click( ... ) { ... }
    protected void Delete_Click( ... ) { ... }
    protected void AvailableModelsRepeater_AddButtonClick( ... ) { ... }
    protected override void Dispose(bool disposing) { ... }
}
```

**ViewModels:**
- `_settings`: Instancia de `SettingsViewModel` que gestiona la configuración general, modelos y servicios de IA.
- `_modelsViewModel`: Instancia de `AIModelsViewModelBase` utilizada para gestionar los modelos de IA.

**Eventos:**
- `AddButtonClick`: Evento que se dispara cuando se hace clic en el botón de agregar modelo.

**Métodos públicos:**
- `CloseModelInfoViewer()`: Método abstracto que debe implementar la lógica para cerrar el visor de información del modelo de IA.

**Otros métodos relevantes:**
- `SetDefault_Click(AIModelClickEventArgs eventArgs)`: Maneja el evento de clic para establecer un modelo de IA como predeterminado.
- `Delete_Click(AIModelClickEventArgs eventArgs)`: Maneja el evento de clic para eliminar un modelo de IA.
- `AvailableModelsRepeater_AddButtonClick(object sender, EventArgs eventArgs)`: Maneja el evento de clic del botón de agregar en el repetidor de modelos disponibles, disparando el evento `AddButtonClick`.
- `Dispose(bool disposing)`: Libera los recursos utilizados por la instancia, incluyendo la disposición del viewmodel de modelos de IA.

#### OllamaModelsPage
**Descripción general:**  
`OllamaModelsPage` es una página de la aplicación PowerPad dedicada a la gestión de modelos de IA de Ollama. Hereda de `AIModelsPageBase` y proporciona una interfaz visual para visualizar, actualizar, eliminar y establecer modelos predeterminados de Ollama, así como para mostrar el estado del servicio Ollama. Está integrada con varios convertidores y componentes personalizados para la interacción con los modelos de IA.

**Estructura visual simplificada:**  
```xml
<local:AIModelsPageBase
    x:Class="PowerPad.WinUI.Pages.Providers.OllamaModelsPage">
    <Grid>
        <Grid>
            <Image Grid.Column="0"/>
            <TextBlock Grid.Column="1" Text="Modelos de Ollama"/>
            <StackPanel Grid.Column="2">
                <TextBlock>Estado Ollama:</TextBlock>
                <TextBlock Text="{x:Bind ...OllamaConfig.ServiceStatus}"/>
                <Button Command="{x:Bind OllamaModelsViewModel.RefreshModelsCommand}">
					<FontIcon/>
                </Button>
            </StackPanel>
            <muxc:InfoBar Grid.Row="1" Grid.ColumnSpan="3"/>
        </Grid>
        <components:AvailableModelsRepeater
            x:Name="AvailableModelsRepeater"
            Grid.Row="1"
            Models="{x:Bind _modelsViewModel.FilteredModels}"
            ModelsEmpty="{x:Bind _modelsViewModel.FilteredModelsEmpty}"
            DeleteClick="Delete_Click"
			SetDefaultClick="SetDefault_Click"
			ModelInfoViewerVisibilityChanged="AIModelsRepeater_ModelInfoViewerVisibilityChanged"
			AddButtonClick="AvailableModelsRepeater_AddButtonClick"/>
    </Grid>
</local:AIModelsPageBase>
```

**Código simplificado:**  
```csharp
public partial class OllamaModelsPage : AIModelsPageBase
{
    private OllamaModelsViewModel OllamaModelsViewModel => _modelsViewModel;
    
    public OllamaModelsPage() : base(new OllamaModelsViewModel()) { ... }
    public override void CloseModelInfoViewer() { ... }
    
    private void AIModelsRepeater_ModelInfoViewerVisibilityChanged( ... ) { ... }
}
```

**Elementos visuales:**  
- `RowHeader`: Fila de encabezado en el Grid principal.
- `Image`: Muestra el logotipo de Ollama.
- `TextBlock`: Título "Modelos de Ollama".
- `StackPanel`: Contenedor horizontal para el estado del servicio y el botón de refresco.
- `TextBlock`: Muestra el texto "Estado Ollama:".
- `TextBlock`: Muestra el estado actual del servicio Ollama, con color y texto dinámicos.
- `Button`: Botón para refrescar la lista de modelos.
- `FontIcon`: Icono de refresco dentro del botón.
- `muxc:InfoBar`: Barra de información que advierte si Ollama no está disponible.
- `components:AvailableModelsRepeater`: Control personalizado que lista los modelos disponibles, permite eliminarlos, establecerlos como predeterminados y añadir nuevos.

**ViewModels:**  
- `_modelsViewModel`: ViewModel base para la gestión de modelos, instancia de `OllamaModelsViewModel` en este contexto, y expuesto como propiedad privada de nombre `OllamaModelsViewModel`.

**Métodos públicos:**
- `override void CloseModelInfoViewer()`: Cierra el visor de información del modelo en la interfaz, delegando la acción al componente visual correspondiente.

**Otros métodos relevantes:**
- `void AIModelsRepeater_ModelInfoViewerVisibilityChanged(Components.Controls.ModelInfoViewerVisibilityEventArgs eventArgs)`: Método privado que gestiona el cambio de visibilidad del visor de información del modelo. Ajusta la altura de la fila de cabecera (`RowHeader`) para mostrar el visor en página completa.

#### Otros proveedores: Hugging Face, GitHub Models y OpenAI
Al igual que `OllamaModelsPage`, las páginas `HuggingFaceModelsPage`, `GitHubModelsPage` y `OpenAIModelsPage` heredan de `AIModelsPageBase` y realizan una implementación muy similar a la descrita en el punto anterior, pero enfocada a su respectivo proveedor.

(AÑADIR IMÁGENES)


### 11.2.3. Páginas para añadir nuevos modelos
#### AIAddModelPageBase
**Descripción general:**
Clase base abstracta para páginas que permiten agregar modelos de IA. Proporciona funcionalidad común para buscar y añadir modelos, gestionando la interacción con el ViewModel de modelos de IA y la configuración global de la aplicación. Incluye métodos para buscar y añadir modelos, que serán utilizados desde las implementaciones específicas.

**Código simplificado:**
```csharp
public abstract class AIAddModelPageBase() : DisposablePage, IModelProviderPage
{
    protected SettingsViewModel _settings;
    protected AIModelsViewModelBase _modelsViewModel;

    public virtual void Search() => _modelsViewModel.SearchModelCommand.Execute(GetSearchTextBox().Text);
    public abstract void CloseModelInfoViewer();

    protected void Search_Click( ... ) => Search();
    protected void Search_KeyDown( ... ) { ... }
    protected void AddModel_Click( ... ) { ... }
    protected abstract TextBox GetSearchTextBox();
    protected override void Dispose(bool disposing) { ... }
}
```

**Propiedades principales:**
- `_settings`: Instancia de `SettingsViewModel` que gestiona la configuración general, modelos y servicios de IA.
- `_modelsViewModel`: Instancia de `AIModelsViewModelBase` utilizada para gestionar los modelos de IA.

**Métodos públicos:**
- `Search()`: Ejecuta la búsqueda de modelos utilizando el texto del cuadro de búsqueda.
- `CloseModelInfoViewer()`: Cierra el visor de información del modelo (debe ser implementado por clases derivadas).

**Otros métodos relevantes:**
- `Search_Click()`: Maneja el evento de clic en el botón de búsqueda y ejecuta la búsqueda.
- `Search_KeyDown(KeyRoutedEventArgs eventArgs)`: Maneja el evento de pulsación de tecla en el cuadro de búsqueda; ejecuta la búsqueda si se presiona Enter.
- `AddModel_Click(AIModelClickEventArgs eventArgs)`: Maneja el evento de clic para agregar un modelo, ejecutando el comando de agregar modelo de forma asíncrona.
- `GetSearchTextBox()`: Método abstracto que debe devolver el control `TextBox` utilizado para la búsqueda.
- `Dispose(bool disposing)`: Libera los recursos utilizados por el ViewModel de modelos de IA.

#### OllamaAddModelPage
**Descripción general:**  
`OllamaAddModelPage` es una página de la aplicación PowerPad.WinUI que permite buscar y agregar modelos de IA desde la biblioteca de Ollama. Utiliza el patrón MVVM y hereda de `AIAddModelPageBase`. Proporciona una interfaz para buscar modelos, mostrar resultados y gestionar la visibilidad de información detallada sobre los modelos. La página está diseñada para integrarse con la configuración y el estado del servicio Ollama, mostrando advertencias si el servicio no está disponible.

**Estructura visual simplificada:**  
```xml
<local:AIAddModelPageBase
    x:Class="PowerPad.WinUI.Pages.Providers.OllamaAddModelPage">
    <Grid>
        <StackPanel>
            <StackPanel>
                <Image/>
                <TextBlock Text="Buscar modelos en la biblioteca de Ollama"/>
            </StackPanel>
            <StackPanel>
                <TextBox x:Name="SearchTextBox"/>
                <Button>
					<FontIcon/>
                </Button>
            </StackPanel>
            <muxc:InfoBar/>
        </StackPanel>
        <Grid Grid.Row="1">
            <components:SearchModelsResultRepeater
                x:Name="SearchModelsResultRepeater"
                SearchingFlag="{x:Bind _modelsViewModel.Searching}"
                Models="{x:Bind _modelsViewModel.SearchResultModels}"
                SearchEmpty="{x:Bind _modelsViewModel.SearchResultModelsEmpty}"
                AddModelClick="AddModel_Click"
ModelInfoViewerVisibilityChanged="SearchModelsResultRepeater_ModelInfoViewerVisibilityChanged"/>
        </Grid>
    </Grid>
</local:AIAddModelPageBase>
```

**Código simplificado:**  
```csharp
public partial class OllamaAddModelPage : AIAddModelPageBase
{
    public OllamaAddModelPage() : base(new OllamaModelsViewModel()) { this.InitializeComponent(); }
    
    public override void Search() { ... }
    public override void CloseModelInfoViewer() { ... }
    
    protected override TextBox GetSearchTextBox() { ... }
    private void SearchModelsResultRepeater_ModelInfoViewerVisibilityChanged( ... ) { ... }
}
```

**Elementos visuales:**  
- `SearchTextBox`: Caja de texto para introducir el nombre del modelo a buscar.
- `SearchModelsResultRepeater`: Control personalizado para mostrar los resultados de búsqueda de modelos y gestionar acciones relacionadas.
- `RowHeader`: Fila del encabezado en la cuadrícula principal, su altura se ajusta dinámicamente.
- `InfoBar`: Barra informativa que muestra advertencias cuando el servicio Ollama no está disponible.
- `Image`: Muestra el logotipo de Ollama.
- `TextBlock`: Título de la página.
- `Button`: Botón para ejecutar la búsqueda, con icono de lupa.
- `FontIcon`: Icono de búsqueda dentro del botón.

**Métodos públicos:**
- `OllamaAddModelPage()`: Inicializa una nueva instancia de la clase `OllamaAddModelPage`, configurando el ViewModel correspondiente y los componentes visuales.
- `override void Search()`: Realiza la búsqueda de modelos en la biblioteca de Ollama, ajustando previamente la altura de la fila del encabezado.
- `override void CloseModelInfoViewer()`: Cierra el visor de información del modelo en la lista de resultados de búsqueda.

**Otros métodos relevantes:**
- `override TextBox GetSearchTextBox()`: Devuelve la referencia al `TextBox` utilizado para la búsqueda de modelos.
- `void AIModelsRepeater_ModelInfoViewerVisibilityChanged(Components.Controls.ModelInfoViewerVisibilityEventArgs eventArgs)`: Método privado que gestiona el cambio de visibilidad del visor de información del modelo. Ajusta la altura de la fila de cabecera (`RowHeader`) para mostrar el visor en página completa.

**Notas adicionales:**
- El control visual utiliza convertidores para habilitar/deshabilitar la búsqueda según el estado del servicio Ollama.
- El método `SearchModelsResultRepeater_ModelInfoViewerVisibilityChanged` es privado y se encarga de mostrar u ocultar el encabezado de la página dependiendo de si el visor de información del modelo está visible.

#### Otros proveedores: Hugging Face, GitHub Models y OpenAI
Al igual que `OllamaAddModelPage`, las páginas `HuggingFaceAddModelPage`, `GitHubAddModelPage` y `OpenAIAddModelPage` heredan de `AIAddModelPageBase` y realizan una implementación muy similar a la descrita en el punto anterior, pero enfocada a su respectivo proveedor.

(AÑADIR IMÁGENES)

### 11.2.4. Página de edición emergente

#### PopupEditorPage
**Descripción general:**  
`PopupEditorPage` es una página de la aplicación WinUI3 que proporciona una interfaz emergente para la edición de notas o textos asistidos por IA. Permite crear, editar, copiar, deshacer/rehacer cambios y aplicar el contenido editado, integrando además un control de agente IA para asistencia inteligente en la edición.

**Estructura visual simplificada:**  
```xml
<Page x:Class="PowerPad.WinUI.Pages.PopupEditorPage">
    <Grid>
        <Grid>
            <StackPanel Orientation="Horizontal">
                <Button x:Name="SaveBtn" Click="SaveBtn_Click" />
                <Button x:Name="CopyBtn" Click="CopyBtn_Click" />
            </StackPanel>
            <Border x:Name="BorderTitleBar" Grid.Column="1" />
            <StackPanel Grid.Column="2" Orientation="Horizontal">
                <Button x:Name="UndoButton" Click="UndoButton_Click" />
                <Button x:Name="RedoButton" Click="RedoButton_Click" />
                <Button x:Name="ApplyBtn" Click="ApplyBtn_Click" />
                <Button x:Name="HideBtn" Click="HideBtn_Click" />
            </StackPanel>
        </Grid>
        <controls:IntegratedTextBox
            x:Name="TextEditor"
            Grid.Row="1"
            Text="{x:Bind _document.Content}" />
        <controls:NoteAgentControl
            x:Name="AgentControl"
            Grid.Row="2" />
    </Grid>
</Page>
```

**Código simplificado:**  
```csharp
public partial class PopupEditorPage : Page
{
    private readonly WorkspaceViewModel _workspace;
    private readonly DocumentViewModel _document;
    
    public Border TitleBar => BorderTitleBar;
    public event EventHandler? CloseRequested;
    
    public PopupEditorPage() { ... }
    public void SetContent(string newContent) { ... }
    public void SetFocus() => AgentControl.SetFocus();
    
    private void TextEditor_SizeChanged( ... ) { ... }
    private T? FindElement<T>(DependencyObject element) where T : DependencyObject { ... }
    private void UndoButton_Click( ... ) { ... }
    private void RedoButton_Click( ... ) { ... }
    private async void CopyBtn_Click( ... ) { ... }
    private void ApplyBtn_Click( ... ) { ... }
    private async void AgentControl_SendButtonClicked( ... ) { ... }
    private void SaveBtn_Click( ... ) { ... }
    private void HideBtn_Click( ... ) { ... }
}
```

**Elementos visuales:**  
- `SaveBtn`: Botón para guardar el contenido como una nueva nota.
- `CopyBtn`: Botón para copiar el contenido actual al portapapeles.
- `BorderTitleBar`: Barra de título visual de la ventana emergente.
- `UndoButton`: Botón para deshacer el último cambio en el contenido.
- `RedoButton`: Botón para rehacer el cambio deshecho previamente.
- `ApplyBtn`: Botón para aplicar el contenido y cerrar el editor, simulando un pegado.
- `HideBtn`: Botón para cerrar la ventana emergente sin aplicar cambios.
- `TextEditor`: Control de texto para editar el contenido.
- `AgentControl`: Control integrado para interacción con un agente IA, permitiendo enviar texto y recibir ediciones automáticas.

**ViewModels:**  
- `_workspace`: Instancia de `WorkspaceViewModel` utilizada para la gestión global del espacio de trabajo y la creación de nuevas notas.
- `_document`: Instancia de `DocumentViewModel` que representa el documento en edición, con soporte para historial de cambios (deshacer/rehacer) y contenido actual.

**Otras propiedades:**  
- `TitleBar`: Propiedad pública que expone el elemento visual de la barra de título (`BorderTitleBar`, lo requiere la ventana para las acciones de mover).

**Eventos:**  
- `CloseRequested`: Evento público que se dispara cuando se solicita cerrar el editor emergente.

**Métodos públicos:**
- `void SetContent(string newContent)`: Establece el contenido del documento y limpia el historial de deshacer/rehacer.
- `void SetFocus()`: Establece el foco en el control de agente (AgentControl).

**Otros métodos relevantes:**
- `void TextEditor_SizeChanged()`: Ajusta el relleno del editor de texto en función de la visibilidad de la barra de desplazamiento vertical.
- `T? FindElement<T>(DependencyObject element) where T : DependencyObject`: Busca un elemento hijo de un tipo específico dentro del árbol visual.
- `void UndoButton_Click()`: Revierte el contenido del documento al estado anterior.
- `void RedoButton_Click()`: Restaura el contenido del documento al siguiente estado.
- `async void CopyBtn_Click(object sender)`: Copia el contenido del documento al portapapeles y muestra una notificación visual temporal.
- `void ApplyBtn_Click()`: Copia el contenido, cierra el editor emergente y simula la acción de pegar (Ctrl+V).
- `async void AgentControl_SendButtonClicked()`: Procesa el contenido del documento con ayuda de IA, actualizando el texto según el resultado y gestionando errores.
- `void SaveBtn_Click()`: Guarda el documento como una nueva nota, cierra el editor emergente y muestra la ventana principal si no está visible.
- `void HideBtn_Click()`: Cierra el editor emergente.

**Notas adicionales:**
- El historial de deshacer/rehacer se gestiona mediante las propiedades `PreviousContent` y `NextContent` del documento.