<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PowerPad.WinUI.Pages.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PowerPad.WinUI.Pages"
    xmlns:components="using:PowerPad.WinUI.Components"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    xmlns:converters="using:PowerPad.WinUI.Converters"
    mc:Ignorable="d">
    <Page.Resources>
        <converters:OllamaOnlineStatusToVisibilityConverter x:Key="OllamaOnlineStatusToVisibilityConverter" />
        <converters:OllamaAvailableStatusToVisibilityConverter x:Key="OllamaAvailableStatusToVisibilityConverter" />
        <Style
            x:Key="SettingsSectionHeaderTextBlockStyle"
            BasedOn="{StaticResource BodyStrongTextBlockStyle}"
            TargetType="TextBlock">
            <Style.Setters>
                <Setter Property="Margin" Value="1,30,0,6" />
            </Style.Setters>
        </Style>
    </Page.Resources>
    <Grid Margin="0,0,0,2">
        <Grid.RowDefinitions>
            <RowDefinition Height="48" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Border
            Grid.Row="1"
            Background="{ThemeResource PowerPadEditorColor}"
            CornerRadius="10,0,0,0">
            <ScrollViewer 
                x:Name="ModelsScrollViewer">
                <Grid Padding="36,24,36,36">
                    <StackPanel
                        MaxWidth="1000"
                        HorizontalAlignment="Stretch">

                        <TextBlock
                            Style="{StaticResource TitleTextBlockStyle}"
                            Text="Ajustes"
                            TextTrimming="CharacterEllipsis"
                            TextWrapping="NoWrap"/>
                        
                        <StackPanel Orientation="Horizontal">
                            <FontIcon Glyph="&#xE977;" Margin="0,16,8,0"/>
                            <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Servicios locales" />
                        </StackPanel>
                        
                        <!-- Ollama Settings -->
                        <toolkit:SettingsExpander
                            x:Name="ModelsExpanderOllama"
                            Header="Ollama"
                            Description="IA generativa en tu equipo local o red privada con Ollama"
                            Margin="0,0,0,4">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <ImageIcon Source="{ThemeResource OllamaSvg}"/>
                            </toolkit:SettingsExpander.HeaderIcon>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <ToggleSwitch IsOn="{x:Bind _settings.General.OllamaEnabled, Mode=TwoWay}" />
                            </StackPanel>
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="150">Estado:</TextBlock>
                                            <TextBlock Foreground="{ThemeResource TextFillColorTertiaryBrush}">Conectado</TextBlock>
                                        </StackPanel>
                                    </toolkit:SettingsCard.Header>
                                    <StackPanel
                                        Margin="0,0,16,0"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                        <Button ToolTipService.ToolTip="Parar" Visibility="{x:Bind _settings.OllamaStatus, Converter={StaticResource OllamaOnlineStatusToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <FontIcon Glyph="&#xE71A;" FontSize="14" Margin="0,0,10,0" />
                                                <TextBlock>Parar</TextBlock>
                                            </StackPanel>
                                        </Button>
                                        <Button ToolTipService.ToolTip="Iniciar" Visibility="{x:Bind _settings.OllamaStatus, Converter={StaticResource OllamaAvailableStatusToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <FontIcon Glyph="&#xE768;" FontSize="14" Margin="0,0,10,0" />
                                                <TextBlock>Iniciar</TextBlock>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="150">Dirección URL:</TextBlock>
                                            <TextBlock Foreground="{ThemeResource TextFillColorTertiaryBrush}">http://localhost:12456</TextBlock>
                                        </StackPanel>
                                    </toolkit:SettingsCard.Header>
                                    <StackPanel
                                        Margin="0,0,16,0"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                        <Button ToolTipService.ToolTip="Parar" Visibility="{x:Bind _settings.OllamaStatus, Converter={StaticResource OllamaOnlineStatusToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock>Editar</TextBlock>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>

                        </toolkit:SettingsExpander>

                        <StackPanel Orientation="Horizontal">
                            <FontIcon Glyph="&#xE753;" Margin="0,22,8,0"/>
                            <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Servicios en línea" />
                        </StackPanel>
                        
                        <!-- AzureAI Settings -->
                        <toolkit:SettingsExpander
                            x:Name="ModelsExpanderAzureAI"
                            Header="Azure AI"
                            Description="{x:Bind _settings.OllamaStatus}"
                            Margin="0,0,0,4">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <ImageIcon Source="{ThemeResource AzureAISvg}"/>
                            </toolkit:SettingsExpander.HeaderIcon>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <ToggleSwitch IsOn="{x:Bind _settings.General.AzureAIEnabled, Mode=TwoWay}" />
                            </StackPanel>
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="150">Dirección URL:</TextBlock>
                                            <TextBlock Foreground="{ThemeResource TextFillColorTertiaryBrush}">http://localhost:12456</TextBlock>
                                        </StackPanel>
                                    </toolkit:SettingsCard.Header>
                                    <StackPanel
                                        Margin="0,0,16,0"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                        <Button ToolTipService.ToolTip="Parar" Visibility="{x:Bind _settings.OllamaStatus, Converter={StaticResource OllamaOnlineStatusToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock>Editar</TextBlock>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="150">Clave:</TextBlock>
                                            <TextBlock Foreground="{ThemeResource TextFillColorTertiaryBrush}">●●●●●●●●</TextBlock>
                                        </StackPanel>
                                    </toolkit:SettingsCard.Header>
                                    <StackPanel
                                        Margin="0,0,16,0"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                        <Button ToolTipService.ToolTip="Parar" Visibility="{x:Bind _settings.OllamaStatus, Converter={StaticResource OllamaOnlineStatusToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock>Editar</TextBlock>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                                <toolkit:SettingsCard HorizontalContentAlignment="Left"
                                    ContentAlignment="Left">
                                    <StackPanel Margin="-12,0,0,0"
                                        Orientation="Vertical">
                                        <HyperlinkButton Content="Pruebe modelos gratuitos de GitHub Models con un token de desarrollador" NavigateUri="https://github.com/settings/tokens" />
                                        <HyperlinkButton Content="Consiga una clave de Azure AI (pago por uso)" NavigateUri="https://ai.azure.com/github" />
                                    </StackPanel>
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>
                        
                        <!-- OpenAI Settings -->
                        <toolkit:SettingsExpander
                            x:Name="ModelsExpanderOpenAI"
                            Header="OpenAI"
                            Description="{x:Bind _settings.OllamaStatus}"
                            Margin="0,0,0,4">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <ImageIcon Source="{ThemeResource OpenAISvg}"/>
                            </toolkit:SettingsExpander.HeaderIcon>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <ToggleSwitch IsOn="{x:Bind _settings.General.OpenAIEnabled, Mode=TwoWay}" />
                            </StackPanel>
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="150">Dirección URL:</TextBlock>
                                            <TextBlock Foreground="{ThemeResource TextFillColorTertiaryBrush}">http://localhost:12456</TextBlock>
                                        </StackPanel>
                                    </toolkit:SettingsCard.Header>
                                    <StackPanel
                                        Margin="0,0,16,0"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                        <Button ToolTipService.ToolTip="Parar" Visibility="{x:Bind _settings.OllamaStatus, Converter={StaticResource OllamaOnlineStatusToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock>Editar</TextBlock>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Width="150">Clave:</TextBlock>
                                            <TextBlock Foreground="{ThemeResource TextFillColorTertiaryBrush}">●●●●●●●●</TextBlock>
                                        </StackPanel>
                                    </toolkit:SettingsCard.Header>
                                    <StackPanel
                                        Margin="0,0,16,0"
                                        Orientation="Horizontal"
                                        Spacing="8">
                                        <Button ToolTipService.ToolTip="Parar" Visibility="{x:Bind _settings.OllamaStatus, Converter={StaticResource OllamaOnlineStatusToVisibilityConverter}}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock>Editar</TextBlock>
                                            </StackPanel>
                                        </Button>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                                <toolkit:SettingsCard HorizontalContentAlignment="Left"
                                    ContentAlignment="Left">
                                    <StackPanel Margin="-12,0,0,0"
                                        Orientation="Vertical">
                                        <HyperlinkButton Content="Consiga una clave de de OpenAI (pago por uso)" NavigateUri="https://platform.openai.com/signup" />
                                    </StackPanel>
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>

                        
                        <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"
                            Text="Parámetros por defecto" />
                        <toolkit:SettingsCard Description="Modelo predeterminado para edición, chats y agentes"
                            Header="Modelo"
                            HeaderIcon="{ui:FontIcon Glyph=&#xF158;}">
                            <DropDownButton>Default</DropDownButton>
                        </toolkit:SettingsCard>

                        <toolkit:SettingsExpander
                            Header="Parámetros"
                            Description="Enviar parámetros adicionales de forma predeterminada"
                            Margin="0,0,0,4">
                            <toolkit:SettingsExpander.HeaderIcon>
                                <ImageIcon Source="{ThemeResource SettingsSvg}"/>
                            </toolkit:SettingsExpander.HeaderIcon>
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <CheckBox>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Width="150" Margin="8,2,0,0">Temperatura:</TextBlock>
                                                <TextBlock Margin="0,2,0,0" Foreground="{ThemeResource TextFillColorTertiaryBrush}">0.8</TextBlock>
                                            </StackPanel>
                                        </CheckBox>
                                    </toolkit:SettingsCard.Header>
                                    <Slider
                                        Width="200" Minimum="500" Maximum="1000" StepFrequency="10"
                                        SmallChange="10" Value="820" />
                                </toolkit:SettingsCard>
                                <toolkit:SettingsCard>
                                    <toolkit:SettingsCard.Header>
                                        <CheckBox>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Width="150" Margin="8,2,0,0">Máximo de tokens:</TextBlock>
                                                <TextBlock Margin="0,2,0,0" Foreground="{ThemeResource TextFillColorTertiaryBrush}">5000</TextBlock>
                                            </StackPanel>
                                        </CheckBox>
                                    </toolkit:SettingsCard.Header>
                                    <Slider
                                        Width="200" Minimum="500" Maximum="1000" StepFrequency="10"
                                        SmallChange="10" Value="820" />
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>
                        

                        <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"
                           Text="Aparencia" />
                            <toolkit:SettingsExpander Description="Seleccionar el tema que se mostrará en la aplicación"
                                           Header="Tema de la aplicación"
                                           HeaderIcon="{ui:FontIcon Glyph=&#xE790;}">
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard HorizontalContentAlignment="Left"
                                               ContentAlignment="Left">
                                    <StackPanel Margin="-12,0,0,0"
                                        Orientation="Vertical">
                                        <RadioButton><TextBlock Margin="8,0,0,0">Claro</TextBlock></RadioButton>
                                        <RadioButton><TextBlock Margin="8,0,0,0">Oscuro</TextBlock></RadioButton>
                                        <RadioButton><TextBlock Margin="8,0,0,0">Configuración del sistema</TextBlock></RadioButton>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                                <toolkit:SettingsCard HorizontalContentAlignment="Left"
                                    ContentAlignment="Left">
                                    <StackPanel Margin="-12,0,0,0" Orientation="Vertical">
                                        <CheckBox><TextBlock Margin="8,2,0,0">Fondo con efecto transparente</TextBlock></CheckBox>
                                    </StackPanel>
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>
                        
                        
                        
                        <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}"
                           Text="Acerca de PowerPad" />
                        <toolkit:SettingsExpander Description="Licencia MIT"
                                           Header="PowerPad"
                                           HeaderIcon="{ui:BitmapIcon Source=ms-appx:///Assets/StoreLogo.scale-200.png}">
                            <TextBlock
                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                               Text="Versión 1.0.0" />
                            <toolkit:SettingsExpander.Items>
                                <toolkit:SettingsCard HorizontalContentAlignment="Left"
                                               ContentAlignment="Left">
                                    <StackPanel Margin="-12,0,0,0"
                                        Orientation="Vertical">
                                        <HyperlinkButton Content="Link 1" />
                                        <HyperlinkButton Content="Link 2" />
                                        <HyperlinkButton Content="Link 3" />
                                    </StackPanel>
                                </toolkit:SettingsCard>
                            </toolkit:SettingsExpander.Items>
                        </toolkit:SettingsExpander>


                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Border>
    </Grid>
</Page>