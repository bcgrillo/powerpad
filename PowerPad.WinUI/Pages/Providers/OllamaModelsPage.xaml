<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="PowerPad.WinUI.Pages.Providers.OllamaModelsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:PowerPad.WinUI.Pages.Providers"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:vm="using:PowerPad.WinUI.ViewModels"
    mc:Ignorable="d"
    Background="{ThemeResource PowerPadEditorColor}">
    <Page.Resources>
        <!--  These styles can be referenced to create a consistent SettingsPage layout  -->
        <!--  Spacing between cards  -->
        <x:Double x:Key="SettingsCardSpacing">4</x:Double>
        <!--  Style (inc. the correct spacing) of a section header  -->
        <Style
            x:Key="SettingsSectionHeaderTextBlockStyle"
            BasedOn="{StaticResource BodyStrongTextBlockStyle}"
            TargetType="TextBlock">
            <Style.Setters>
                <Setter Property="Margin" Value="1,30,0,6" />
            </Style.Setters>
        </Style>
    </Page.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <TextBlock
            Style="{StaticResource TitleTextBlockStyle}"
            Text="Ollama"
            TextTrimming="CharacterEllipsis"
            TextWrapping="NoWrap"
            Margin="36,24,36,20"/>
        <ScrollViewer Grid.Row="1">
            <Grid Padding="36,0,36,36">
                <StackPanel
                    MaxWidth="1000"
                    HorizontalAlignment="Stretch"
                    Spacing="{StaticResource SettingsCardSpacing}">
                    <TextBlock Style="{StaticResource SettingsSectionHeaderTextBlockStyle}" Text="Model management" />
                    <toolkit:SettingsExpander
                        x:Name="ModelsExpander"
                        AutomationProperties.AccessibilityView="Raw"
                        Description="Models are cached on your disk"
                        Header="Model cache"
                        HeaderIcon="{ui:FontIcon Glyph=&#xF158;}"
                        ItemsSource="{x:Bind _ollama.Models, Mode=OneWay}"
                        IsExpanded="True">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <HyperlinkButton
                                x:Name="FolderPathTxt"
                                VerticalAlignment="Center"
                                AutomationProperties.LocalizedControlType="Button"
                                FontSize="12" />
                            <Button
                                Content="Change"
                                Visibility="Visible" />
                        </StackPanel>
                        <toolkit:SettingsExpander.ItemsHeader>
                            <toolkit:SettingsCard
                                x:Name="totalCacheCard"
                                BorderThickness="0"
                                CornerRadius="0"
                                Header="Total cache">
                                <StackPanel
                                    Margin="0,0,16,0"
                                    Orientation="Horizontal"
                                    Spacing="8">
                                    <TextBlock
                                        x:Name="TotalCacheTxt"
                                        VerticalAlignment="Center"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                    <Button
                                        AutomationProperties.Name="Clear cache"
                                        Content="Clear"
                                        ToolTipService.ToolTip="Clear cache" />
                                </StackPanel>
                            </toolkit:SettingsCard>
                        </toolkit:SettingsExpander.ItemsHeader>
                        <toolkit:SettingsExpander.ItemTemplate>
                            <DataTemplate x:DataType="vm:ModelInfoViewModel">
                                <toolkit:SettingsCard Header="{x:Bind Name}">
                                    <toolkit:SettingsCard.Description>
                                        <HyperlinkButton Tag="{x:Bind}">
                                            <TextBlock Text="{x:Bind ModelStatus}" TextWrapping="Wrap" />
                                        </HyperlinkButton>
                                    </toolkit:SettingsCard.Description>
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <TextBlock
                                            VerticalAlignment="Center"
                                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                            Text="xxx" />
                                        <Button
                                    AutomationProperties.Name="Delete"
                                    Content="{ui:FontIcon Glyph=&#xE74D;,FontSize=14}"
                                    Tag="{x:Bind}"
                                    ToolTipService.ToolTip="Delete" />
                                    </StackPanel>
                                </toolkit:SettingsCard>
                            </DataTemplate>
                        </toolkit:SettingsExpander.ItemTemplate>
                    </toolkit:SettingsExpander>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</Page>
